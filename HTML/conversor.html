<html>
	<head>
		<title>Conversor horarios Ko-Ko</title>
		<script src="files/jquery.js" type="text/javascript"></script>
		<script src="files/xprototype.js" type="text/javascript"></script>
		<script src="../DroidScript/db.js" type="text/javascript"></script>
		<script src="../DroidScript/db.dias.js" type="text/javascript"></script>
		<script src="../DroidScript/db.horarios.js" type="text/javascript"></script>
		<script src="../DroidScript/db.localidades.js" type="text/javascript"></script>
		<script src="../DroidScript/db.tipos.js" type="text/javascript"></script>
		<script src="files/conversor.js" type="text/javascript"></script>
		<style type="text/css">
			.layout {
				width: 100%;
			}

			textarea {
				width: 100%;
				height: 200px;
			}
		</style>
	</head>
	<body>
		<table class="layout">
			<tr>
				<td colspan="2">
					<select id="txtTitle" style="width: 100%"></select>
					<script type="text/javascript">
						$(function () {
							var txtTitle = $('#txtTitle');
							$db.tipos.each(function () {
								var d = this;
								if (d.id) {
									txtTitle.append(`<option value="${d.id}">${d.text}</option>`);
								}
							});
						});
					</script>
				</td>
			</tr>
			<tr>
				<td colspan="2">
					<select id="txtDays" style="width: 100%"></select>
					<script type="text/javascript">
						$(function () {
							var txtDays = $('#txtDays');
							$db.dias.each(function () {
								var d = this;
								txtDays.append(`<option value="${d.id}">${d.text}</option>`);
							});
						});
					</script>
				</td>
			</tr>
			<tr>
				<td>Roca | Allen | Nqn</td>
				<td>Nqn | Allen | Roca</td>
			</tr>
			<tr>
				<td>
					<textarea id="txtInRA"></textarea>
				</td>
				<td>
					<textarea id="txtInAR"></textarea>
				</td>
			</tr>
			<tr>
				<td colspan="2">
					<button type="button" onclick="javascript:proccess()">Procesar</button>
					<script>
						function proccess() {
							var type = $('#txtTitle option:selected'),
								day = $('#txtDays option:selected');

							// Roca -> Allen
							var o = proccessTable('txtInRA', '#tableOutRA');
							// Allen -> Roca
							o = o.concat(proccessTable('txtInAR', '#tableOutAR'));

							localStorage.setItem('txtTitle', $('#txtTitle').val());
							localStorage.setItem('txtDays', $('#txtDays').val());

							// Output
							$('#txtOut').val(
								'// ' + day.text() + '\n' +
								'// ' + type.text() + '\n' +
								JSON.stringify({
									dia: day.val(),
									tipo: type.val(),
									recorrido: JSON.parse('[' + o.toStr() + ']')
								}, 1, 1) +
								','
							);
						}
					</script>
					<hr />
				</td>
			</tr>
			<!--
			<tr>
				<td id="tableOutRA"></td>
				<td id="tableOutAR"></td>
			</tr>
			-->
			<tr>
				<td colspan="2">
					<textarea id="txtOut" readonly="readonly"></textarea>
				</td>
			</tr>
		</table>
		<script>
			$(function () {
				$('#txtInRA').val(localStorage.txtInRA);
				$('#txtInAR').val(localStorage.txtInAR);
				$('#txtTitle').val(localStorage.txtTitle);
				$('#txtDays').val(localStorage.txtDays);
			});
		</script>
	</body>
</html>